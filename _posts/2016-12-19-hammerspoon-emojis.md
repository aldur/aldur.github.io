---
layout: post
title: Hammerspoon - Emoji Chooser
excerpt: >
    Search and select emojis by name, with Hammerspoon.
modified: 2016-12-19
categories: articles
tags: [hammerspoon, emoji]
comments: true
share: true
---

Lately, I've been using the awesome [Hammerspoon](https://github.com/Hammerspoon/hammerspoon) to automate some of the aspects of macOS.
As an example of its potential, we'll now see how to create an interactive emoji search-engine, that will allow us to search, select and paste emojis by using their name or a few keywords.

As a result, we'll get something like this:

{:.center}
![emoji-chooser](/images/emoji-chooser.png){:class="img-responsive"}

## Preliminary setup

Before we begin, download [this archive](/uploads/emojis.zip) and unzip into your `~/.hammerspoon` directory.
The archive contains a few thousands `PNG` images depicting the emojis and a `JSON` file encoding their details.
It has been generated by using the utility you can find [here](https://gist.github.com/aldur/6b591c582db8a9134f31263f95cccfc2).

## Hammerspoon setup

Now, we'll use Hammerspoon to load the emojis and build the search engine.
To do so we'll use `hs.chooser`, an Hammerspoon extension that creates a Spotlight-like window that allows filtering and selecting data.
We'll populate it with emojis; once selected, the emoji will be copied to clipboard and "typed" in the focused application.

Copy and paste the following snippet in your `init.lua` file:

```lua
-- Build the list of emojis to be displayed.
local choices = {}
for _, emoji in ipairs(hs.json.decode(io.open("emojis/emojis.json"):read())) do
    table.insert(choices,
        {text=emoji['name'],
            subText=table.concat(emoji['kwds'], ", "),
            image=hs.image.imageFromPath("emojis/" .. emoji['id'] .. ".png"),
            chars=emoji['chars']
        })
end

-- Focus the last used window.
local function focusLastFocused()
    local wf = hs.window.filter
    local lastFocused = wf.defaultCurrentSpace:getWindows(wf.sortByFocusedLast)
    if #lastFocused > 0 then lastFocused[1]:focus() end
end

-- Create the chooser.
-- On selection, copy the emoji and type it into the focused application.
local chooser = hs.chooser.new(function(choice)
    if not choice then focusLastFocused(); return end
    hs.pasteboard.setContents(choice["chars"])
    focusLastFocused()
    hs.eventtap.keyStrokes(hs.pasteboard.getContents())
end)

chooser:searchSubText(true)
chooser:choices(choices)
```

If you want, you can also customize the appearance of the chooser:

```lua
chooser:rows(5)
chooser:bgDark(true)
```

As a final step, bind the chooser to any key you like:

```lua
hs.hotkey.bind({"cmd", "alt"}, "E", function() chooser:show() end)
```

## Other tips

As a final note, you can find my Hammerspoon complete configuration [here](https://github.com/aldur/dotfiles/tree/master/osx/hammerspoon).
